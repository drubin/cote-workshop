project:
  name: cote-workshop
  environments:
    - name: local
      providers:
        - name: local-kubernetes
module:
  description: cote-workshop
  type: container
  name: cote-workshop
  services:
    - name: admin
      command: ["/bin/sh", "-c", "DISCOVERY_HOSTNAME=$POD_IP node admin/server.js"]
      env:
        PG: true
        COTE_DISCOVERY_REDIS_HOST: redis
      dependencies:
        - fixture
        - redis
      ports:
        - name: http
          containerPort: 5000
      ingresses:
        - path: /
          port: http
          hostname: admin.cote-workshop.local.app.garden

    - name: end-user
      command: ["/bin/sh", "-c", "DISCOVERY_HOSTNAME=$POD_IP node end-user/server.js"]
      env:
        PG: true
        COTE_DISCOVERY_REDIS_HOST: redis
      dependencies:
        - fixture
        - redis
      ports:
        - name: http
          containerPort: 5001
      ingresses:
        - path: /
          port: http
    - name: payment-service
      command: ["/bin/sh", "-c", "DISCOVERY_HOSTNAME=$POD_IP node services/payment-service.js"]
      dependencies:
        - fixture
        - redis
      env:
        PG: true
        COTE_DISCOVERY_REDIS_HOST: redis
    
    - name: product-service
      command: ["/bin/sh", "-c", "DISCOVERY_HOSTNAME=$POD_IP node services/product-service.js"]
      dependencies:
        - fixture
        - redis
      env:
        PG: true
        COTE_DISCOVERY_REDIS_HOST: redis

    - name: purchase-service
      command: ["/bin/sh", "-c", "DISCOVERY_HOSTNAME=$POD_IP node services/purchase-service.js"]
      dependencies:
        - fixture
        - redis
      env:
        PG: true
        COTE_DISCOVERY_REDIS_HOST: redis

    - name: user-service
      command: ["/bin/sh", "-c", "DISCOVERY_HOSTNAME=$POD_IP node services/user-service.js"]
      dependencies:
        - fixture
        - redis
      env:
        PG: true
        COTE_DISCOVERY_REDIS_HOST: redis

    - name: fixture
      command: ["/bin/sh", "-c", "DISCOVERY_HOSTNAME=$POD_IP node init-db.js"]
      dependencies:
        - postgres
      env:
        PG: true
        COTE_DISCOVERY_REDIS_HOST: redis
